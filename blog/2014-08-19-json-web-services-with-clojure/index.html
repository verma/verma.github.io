<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>JSON Web Services with Clojure | Uday Verma's Blog</title><meta name=keywords content><meta name=description content="Go through a quick exercise to make writing JSON Web Services a breeze, a fun filled breeze."><meta name=author content><link rel=canonical href=http://udayv.com/blog/2014-08-19-json-web-services-with-clojure/><link href=/assets/css/stylesheet.min.3dac925eb9bf5bf78d5d4e966755e4f4ae8ca86c5a9a3d1dcff2aaef78333302.css integrity="sha256-PaySXrm/W/eNXU6WZ1Xk9K6MqGxamj0dz/Kq73gzMwI=" rel="preload stylesheet" as=style><link rel=icon href=http://udayv.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://udayv.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://udayv.com/favicon-32x32.png><link rel=apple-touch-icon href=http://udayv.com/apple-touch-icon.png><link rel=mask-icon href=http://udayv.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="JSON Web Services with Clojure"><meta property="og:description" content="Go through a quick exercise to make writing JSON Web Services a breeze, a fun filled breeze."><meta property="og:type" content="article"><meta property="og:url" content="http://udayv.com/blog/2014-08-19-json-web-services-with-clojure/"><meta property="article:published_time" content="2014-08-19T00:00:00+00:00"><meta property="article:modified_time" content="2014-08-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="JSON Web Services with Clojure"><meta name=twitter:description content="Go through a quick exercise to make writing JSON Web Services a breeze, a fun filled breeze."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"http://udayv.com/blog/"},{"@type":"ListItem","position":2,"name":"JSON Web Services with Clojure","item":"http://udayv.com/blog/2014-08-19-json-web-services-with-clojure/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"JSON Web Services with Clojure","name":"JSON Web Services with Clojure","description":"Go through a quick exercise to make writing JSON Web Services a breeze, a fun filled breeze.","keywords":[],"articleBody":"Less reading more coding.\nThe goal here is to setup Compojure in such a way that we just deal in Clojure maps when writing our Web Service.\nAll code for this exercise is available here.\nPre-reqs This exersise assumes some knowledge of Clojure and Compojure, here are some nice starting points:\n Creating and managing projects with lein. Compojure. Routes in Compojure. Ring  Setup a project lein new compojure api-test  This sets up api-test with a basic Compojure template.\nAdd some deps ;; project.clj ;; ... :dependencies [[org.clojure/clojure \"1.6.0\"] [ring/ring-json \"0.3.1\"] [compojure \"1.1.8\"]]  Run the server (it will update itself whenever you make a code change, you don’t have to keep restarting the server, unless you add more dependencies)\nlein ring server  Add JSON middleware Change your app definition to include the required middleware (make sure you require the middleware as well):\n;; src/api_test/handler.clj (ns api-test.handler (:require [compojure.core :refer :all] [compojure.handler :as handler] [ring.middleware.json :as middleware] [compojure.route :as route])) ;; ... (def app (- (handler/site app-routes) (middleware/wrap-json-body {:keywords? true}) middleware/wrap-json-response)) The {:keywords? true} above makes sure that when my body is parsed, I get my keys as keywords and not as strings.\nWrite a handler You get two things out of doing all this so far:\n All JSON request bodies are parsed into nice looking maps for your convenience. Response bodies can now be maps as well, which will be converted into JSON before they’re put on the wire.  Lets write the handler (just look at the POST \"/\" stuff, read more about Compojure to learn what other things do):\n(defroutes app-routes (POST \"/\" request (let [name (or (get-in request [:params :name]) (get-in request [:body :name]) \"John Doe\")] {:status 200 :body {:name name :desc (str \"The name you sent to me was \" name)}})) (route/resources \"/\") (route/not-found \"Not Found\")) First it figures the name of the sender, it could be either in params, the body or defaults to \"John Doe\" (see how nicely you can query the body here for things).\n;; ... {:status 200 :body {:name name :desc (str \"The name you sent to me was \" name)}} This is how you generate your body now, just a simple clojure map.\nTest it Lets check it out in console:\n$ curl -X POST http://localhost:3000/ \\ --data '{\"name\":\"verma\"}' --header \"Content-type:application/json\" {\"name\":\"verma\",\"desc\":\"The name you sent to me was verma\"} $ curl -X POST --data 'name=verma' http://localhost:3000/ {\"name\":\"verma\",\"desc\":\"The name you sent to me was verma\"} $ curl -X POST http://localhost:3000/ {\"name\":\"John Doe\",\"desc\":\"The name you sent to me was John Doe\"}  Credits Thanks to jakecraige and milos_cohagen for their corrections, comments and suggestions on #clojure @ freenode. Come join the fun!\nUntil next time!\n","wordCount":"440","inLanguage":"en","datePublished":"2014-08-19T00:00:00Z","dateModified":"2014-08-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://udayv.com/blog/2014-08-19-json-web-services-with-clojure/"},"publisher":{"@type":"Organization","name":"Uday Verma's Blog","logo":{"@type":"ImageObject","url":"http://udayv.com/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=http://udayv.com/ accesskey=h title="Uday Verma's Blog (Alt + H)">Uday Verma's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>JSON Web Services with Clojure</h1><section class=entry-tags><p>clojure</p></section><div class=post-meta>August 19, 2014&nbsp;·&nbsp;3 min</div></header><div class=post-content><p>Less reading more coding.</p><p>The goal here is to setup Compojure in such a way that we just deal in Clojure maps when writing our Web Service.</p><p>All code for this exercise is available <a href=https://github.com/verma/json-webservice-test>here</a>.</p><h3 id=pre-reqs>Pre-reqs<a hidden class=anchor aria-hidden=true href=#pre-reqs>#</a></h3><p>This exersise assumes some knowledge of Clojure and Compojure, here are some nice starting points:</p><ul><li><a href=https://github.com/technomancy/leiningen/blob/stable/doc/TUTORIAL.md>Creating and managing projects with lein</a>.</li><li><a href=https://github.com/weavejester/compojure>Compojure</a>.</li><li><a href=https://github.com/weavejester/compojure/wiki/Routes-In-Detail>Routes in Compojure</a>.</li><li><a href=https://github.com/ring-clojure/ring>Ring</a></li></ul><h3 id=setup-a-project>Setup a project<a hidden class=anchor aria-hidden=true href=#setup-a-project>#</a></h3><pre><code>lein new compojure api-test
</code></pre><p>This sets up <code>api-test</code> with a basic <a href=https://github.com/weavejester/compojure>Compojure</a> template.</p><h3 id=add-some-deps>Add some deps<a hidden class=anchor aria-hidden=true href=#add-some-deps>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=color:#75715e>;; project.clj</span>
<span style=color:#75715e>;; ...</span>
<span style=color:#e6db74>:dependencies</span> [[org.clojure/clojure <span style=color:#e6db74>&#34;1.6.0&#34;</span>]
               [ring/ring-json <span style=color:#e6db74>&#34;0.3.1&#34;</span>]
               [compojure <span style=color:#e6db74>&#34;1.1.8&#34;</span>]]                 </code></pre></div><p>Run the server (it will update itself whenever you make a code change, you don&rsquo;t have to keep restarting the server, unless you add more dependencies)</p><pre><code>lein ring server
</code></pre><h3 id=add-json-middleware>Add JSON middleware<a hidden class=anchor aria-hidden=true href=#add-json-middleware>#</a></h3><p>Change your app definition to include the required middleware (make sure you require the middleware as well):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=color:#75715e>;; src/api_test/handler.clj</span>

(<span style=color:#66d9ef>ns </span>api-test.handler
  (<span style=color:#e6db74>:require</span> [compojure.core <span style=color:#e6db74>:refer</span> <span style=color:#e6db74>:all</span>]
            [compojure.handler <span style=color:#e6db74>:as</span> handler]
            [ring.middleware.json <span style=color:#e6db74>:as</span> middleware]
            [compojure.route <span style=color:#e6db74>:as</span> route]))

<span style=color:#75715e>;; ...</span>

(<span style=color:#66d9ef>def </span>app
  (-&gt; (<span style=color:#a6e22e>handler/site</span> app-routes)
      (<span style=color:#a6e22e>middleware/wrap-json-body</span> {<span style=color:#e6db74>:keywords?</span> true})
      middleware/wrap-json-response))</code></pre></div><p>The <code>{:keywords? true}</code> above makes sure that when my body is parsed, I get my keys as keywords and not as strings.</p><h3 id=write-a-handler>Write a handler<a hidden class=anchor aria-hidden=true href=#write-a-handler>#</a></h3><p>You get two things out of doing all this so far:</p><ol><li>All JSON request bodies are parsed into nice looking maps for your convenience.</li><li>Response bodies can now be maps as well, which will be converted into JSON before they&rsquo;re put on the wire.</li></ol><p>Lets write the handler (just look at the <code>POST "/"</code> stuff, <a href=http://weavejester.github.io/compojure/compojure.route.html>read more</a> about Compojure to learn what other things do):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure>(<span style=color:#a6e22e>defroutes</span> app-routes
  (<span style=color:#a6e22e>POST</span> <span style=color:#e6db74>&#34;/&#34;</span> request
    (<span style=color:#66d9ef>let </span>[name (or (<span style=color:#a6e22e>get-in</span> request [<span style=color:#e6db74>:params</span> <span style=color:#e6db74>:name</span>])
                   (<span style=color:#a6e22e>get-in</span> request [<span style=color:#e6db74>:body</span> <span style=color:#e6db74>:name</span>])
                   <span style=color:#e6db74>&#34;John Doe&#34;</span>)]
      {<span style=color:#e6db74>:status</span> <span style=color:#ae81ff>200</span>
       <span style=color:#e6db74>:body</span> {<span style=color:#e6db74>:name</span> name
       <span style=color:#e6db74>:desc</span> (str <span style=color:#e6db74>&#34;The name you sent to me was &#34;</span> name)}}))
  (<span style=color:#a6e22e>route/resources</span> <span style=color:#e6db74>&#34;/&#34;</span>)
  (<span style=color:#a6e22e>route/not-found</span> <span style=color:#e6db74>&#34;Not Found&#34;</span>))</code></pre></div><p>First it figures the name of the sender, it could be either in <code>params</code>, the <code>body</code> or defaults to <code>"John Doe"</code> (see how nicely you can query the body here for things).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=color:#75715e>;; ...</span>
{<span style=color:#e6db74>:status</span> <span style=color:#ae81ff>200</span>
 <span style=color:#e6db74>:body</span> {<span style=color:#e6db74>:name</span> name
        <span style=color:#e6db74>:desc</span> (str <span style=color:#e6db74>&#34;The name you sent to me was &#34;</span> name)}}</code></pre></div><p>This is how you generate your body now, just a simple clojure map.</p><h3 id=test-it>Test it<a hidden class=anchor aria-hidden=true href=#test-it>#</a></h3><p>Lets check it out in console:</p><pre><code>$ curl -X POST http://localhost:3000/ \
        --data '{&quot;name&quot;:&quot;verma&quot;}' --header &quot;Content-type:application/json&quot;
{&quot;name&quot;:&quot;verma&quot;,&quot;desc&quot;:&quot;The name you sent to me was verma&quot;}

$ curl -X POST --data 'name=verma' http://localhost:3000/
{&quot;name&quot;:&quot;verma&quot;,&quot;desc&quot;:&quot;The name you sent to me was verma&quot;}

$ curl -X POST  http://localhost:3000/
{&quot;name&quot;:&quot;John Doe&quot;,&quot;desc&quot;:&quot;The name you sent to me was John Doe&quot;}
</code></pre><h3 id=credits>Credits<a hidden class=anchor aria-hidden=true href=#credits>#</a></h3><p>Thanks to <code>jakecraige</code> and <code>milos_cohagen</code> for their corrections, comments and suggestions on <code>#clojure</code> @ freenode. Come join the fun!</p><p>Until next time!</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=http://udayv.com/>Uday Verma's Blog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>